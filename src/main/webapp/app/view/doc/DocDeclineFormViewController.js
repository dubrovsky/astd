/*
 * File: app/view/doc/DocDeclineFormViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('ASTD.view.doc.DocDeclineFormViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.doc.docdeclineformview',

    onComplete: function(options, success, response) {
        Ext.Msg.hide();
        Ext.toast({
            title: 'Отклонение',
            html: success ? 'Данные успешно сохранены' : 'Ошибка',
            align: 'tr',
            bodyPadding: 10
        });
        Ext.Msg.wait("Загрузка", "Загрузка списка");
        this.getViewModel().get('docList').getStore().reload();
        this.getView().close();
    },

    onSaveClick: function(button, e, eOpts) {
        var form = this.lookupReference('docDeclineForm');

        if (form.isValid()) {
            Ext.Msg.wait('Сохранение', 'Сохранение данных...');

            var currentDoc = this.getViewModel().get('currentDoc');
            Ext.Ajax.request({
                url: currentDoc.getProxy().getUrl() + '/reject/' + currentDoc.getId(),
                method: 'POST',
                params: {msg: this.getViewModel().get('msg')},
                scope: this,
                callback: this.onComplete
            });
        }
    },

    onCancelClick: function(button, e, eOpts) {
        this.getView().close();
    }

});
