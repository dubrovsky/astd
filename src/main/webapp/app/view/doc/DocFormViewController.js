/*
 * File: app/view/doc/DocFormViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.6.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.6.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('ASTD.view.doc.DocFormViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.doc.docformview',

    onComplete: function(record, operation, success) {
        Ext.Msg.hide();
        Ext.toast({
            title: 'Сохранение',
            html: success ? 'Документ успешно сохранен' : 'Ошибка',
            align: 'tr',
            bodyPadding: 10
        });

        if(operation.getRequest().getMethod() === 'POST' && !this.getViewModel().get('currentCatalog').get('readOnly')){
            this.getViewModel().get('currentCatalog').set('readOnly', true);
        }
        Ext.Msg.wait("Загрузка", "Загрузка списка");
        this.getViewModel().get('docList').getStore().reload();
        this.getView().close();
    },

    onSaveClick: function(button, e, eOpts) {
        var form = this.lookupReference('docForm'),
            rec;

        if (form.isValid()) {
            rec = this.getViewModel().get('currentDoc');
            Ext.Msg.wait('Сохранение', 'Сохранение документа...');
            rec.save({
                scope: this,
                callback: this.onComplete
            });
        }
    },

    onCancelClick: function(button, e, eOpts) {
        this.getViewModel().get('currentDoc').reject();
        this.getView().close();
    }

});
